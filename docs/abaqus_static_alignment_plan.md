# Abaqus 静力学对标下一步实施计划（优先级版）

本文面向当前求解器代码结构（`inp_parser` + `solver` + 元素本构模块），将“对标 Abaqus 静力学”的四个高优先方向拆分为可执行里程碑，减少一次性重构风险。

## P0：接触残量/切线刚度（法向接触 + 摩擦）

### 目标
- 在 Newton 迭代中显式装配接触贡献：
  - 残量：`R += R_contact`
  - 切线：`K += K_contact`
- 支持小滑移罚函数法起步，后续可扩展增广拉格朗日。

### 最小可交付（MVP）
1. 法向无穿透（node-to-surface 或 surface-to-surface 简化版）。
2. 库仑摩擦（粘着/滑移判据，返回映射风格一致切线）。
3. 接触状态历史变量（open/stick/slip）在增量步内可更新并回滚。

### 数据结构建议
- `ContactConstraint`
  - 主从面引用
  - 法向罚系数 `kn`
  - 切向罚系数 `kt`
  - 摩擦系数 `mu`
- `ContactGaussState`
  - gap、切向相对位移
  - 接触状态（open/stick/slip）
  - 历史切向牵引

### 数值实现要点
- 法向：`pn = kn * < -gap >`
- 摩擦试算：`||t_trial|| <= mu * pn` 判粘着，否则滑移投影。
- 一致切线分块：
  - 法向项 `kn * n⊗n`
  - 切向粘着项 `kt * (I - n⊗n)`
  - 滑移项使用返回映射导数近似，保证 NR 收敛稳定。

### 验证算例
- 斜面块体压入（无摩擦）
- 平面推块（有摩擦，检验 stick/slip 转换）
- 接触 patch test（网格加密收敛）

---

## P1：耦合约束方程显式组装（MPC/Lagrange）

### 目标
- 将 `*Coupling/*Kinematic` 从“解析存储”升级为“求解可用约束方程”。

### 实施路线
1. **MPC 消元法**（优先，工程可用快）
   - 从约束关系构建从属自由度映射。
   - 组装后对 K、R 做静态缩并。
2. **Lagrange 乘子法**（第二阶段）
   - 扩展增广方程：
     \[
     \begin{bmatrix}
     K & C^T \\
     C & 0
     \end{bmatrix}
     \begin{bmatrix}
     \Delta u \\
     \Delta \lambda
     \end{bmatrix}
     =
     -\begin{bmatrix}
     R \\
     g
     \end{bmatrix}
     \]
   - 为后续接触拉格朗日框架复用接口。

### 验证算例
- RBE2 类刚性耦合位移一致性
- 参考点-面耦合反力守恒

---

## P2：壳与实体多积分点 + hourglass 控制

### 目标
- 提升 `S4/S4R` 与 `C3D8/C3D8R` 在弯曲、剪切、畸变工况下的精度和稳定性。

### 实施建议
1. `C3D8`：支持 2x2x2 全积分。
2. `C3D8R`：单点积分 + Flanagan-Belytschko hourglass 控制（刚度型或粘性型，优先刚度型）。
3. `S4/S4R`：分层积分（膜/弯曲/剪切），并增加减缩积分防剪切锁死。

### 状态变量
- 每积分点独立存储应力、应变、塑性变量。
- 输出层支持积分点到节点外推与体积平均。

### 验证算例
- 悬臂梁端载（壳/实体对比解析解）
- 单元畸变敏感性测试
- hourglass 零能模态抑制测试

---

## P3：非线性步自适应弧长法（cutback + RIKS 半径调节）

### 目标
- 在极限点、软化与后屈曲路径中稳定追踪平衡支路。

### 建议算法骨架
1. 约束形式（球弧长）：
   \[
   \Delta u^T W \Delta u + \alpha \Delta \lambda^2 = \Delta s^2
   \]
2. 每个增量内联立求解 `\Delta u, \Delta \lambda`。
3. 预测-校正：
   - 预测方向来自上一步切线方向
   - 校正采用扩展牛顿迭代
4. 半径调节（RIKS 风格）：
   - 收敛快 -> 放大 `\Delta s`
   - 迭代超限/发散 -> cutback 并缩小 `\Delta s`

### 与现有 cutback 的衔接
- 复用已有“步失败回退重算”机制。
- 将“载荷比例因子”推广为弧长控制变量 `\lambda`。

### 验证算例
- 浅拱极限点路径
- 双稳态壳跳跃问题

---

## 推荐落地节奏（两迭代）

### 迭代 A（先求稳）
- P0 MVP（法向 + 摩擦，罚函数）
- P1 MPC 消元
- 基础验证集与回归脚本

### 迭代 B（再增强）
- P2 多积分点 + hourglass
- P3 弧长法（含半径调节）
- P1 Lagrange 乘子增强

---

## 完成判据（DoD）
- 非线性问题可在固定容差内稳定收敛（残量与位移增量双准则）。
- 新增功能均有最小算例 + 回归测试。
- 文档明确关键参数默认值（`kn/kt/mu`、hourglass 系数、初始弧长与调节系数）。
